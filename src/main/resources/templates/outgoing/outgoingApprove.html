<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<body>
<div class="page-inner" layout:fragment="content">
    <div class="page-header">
        <h3 class="fw-bold mb-3">ì…/ì¶œê³  ê´€ë¦¬</h3>
        <ul class="breadcrumbs mb-3">
            <li class="nav-home">
                <a href="#">
                    <i class="icon-home"></i>
                </a>
            </li>
            <li class="separator">
                <i class="icon-arrow-right"></i>
            </li>
            <li class="nav-item">
                <a href="#">ì…/ì¶œê³  ê´€ë¦¬</a>
            </li>
            <li class="separator">
                <i class="icon-arrow-right"></i>
            </li>
            <li class="nav-item">
                <a href="#">ì¶œê³  ìŠ¹ì¸</a>
            </li>
        </ul>
    </div>
    <div class="col-md-12">
        <div class="card border-success">
            <div class="card-header bg-danger text-white text-center">
                <h4 class="card-title m-0">ğŸ„ ì¶œê³  ìŠ¹ì¸ ğŸ…</h4>
            </div>

            <!-- ê¸°ì¡´ í…Œì´ë¸” -->
            <div class="card-body">
                <div class="table-responsive">
                    <table id="basic-datatables" class="display table table-striped table-hover">
                        <!-- í…Œì´ë¸” í—¤ë” -->
                        <thead>
                        <tr>
                            <!-- ì²´í¬ë°•ìŠ¤ ì¹¼ëŸ¼ -->
                            <th><input type="checkbox" id="select-all"></th> <!-- ì „ì²´ ì„ íƒ -->
                            <th>ì¶œê³ ID</th>
                            <th>ì¶œê³ ë‚ ì§œ</th>
                            <th>ì°½ê³ ì´ë¦„</th>
                            <th>ì§€ì ì´ë¦„</th>
                            <th>ì¹´í…Œê³ ë¦¬</th>
                            <th>ìƒí’ˆëª…</th>
                            <th>ì¶œê³ ìˆ˜ëŸ‰</th>
                            <th>ìƒí’ˆê°€ê²©</th>
                            <th>ì´ê°€ê²©</th>
                            <th>ì¶œê³ ìƒíƒœ</th>
                        </tr>
                        </thead>

                        <!-- í…Œì´ë¸” ë°”ë”” -->
                        <tbody>
                        <!-- ìƒíƒœê°€ 'ëŒ€ê¸°'ì¸ ë°ì´í„°ë§Œ ë Œë”ë§ -->
                        <tr th:each="OutgoingDTO : ${list}" th:if="${OutgoingDTO.outgoingStatus} == 'ëŒ€ê¸°'">
                            <!-- ì²´í¬ë°•ìŠ¤ ì¹¼ëŸ¼ -->
                            <td><input type="checkbox" name="select-row" th:value="${OutgoingDTO.outgoingId}"></td>

                            <!-- ë‚˜ë¨¸ì§€ ë°ì´í„° -->
                            <td th:text="${OutgoingDTO.outgoingId}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.formattedOutgoingDate}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.warehouseName}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.branchName}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.productCategory}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.productName}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.outgoingQuantity}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.formattedProductPrice}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.formattedTotalPrice}" class="text-center"></td>
                            <td th:text="${OutgoingDTO.outgoingStatus}" class="text-center"></td>
                        </tr>

                        </tbody>
                        <!-- í”Œë¡œíŒ… ë²„íŠ¼ -->
                        <div id="floating-button-approve" onclick="confirmApproval()">ì¶œê³  ìŠ¹ì¸</div>
                        <div id="floating-button-reject" onclick="confirmRejection()">ì¶œê³  ê±°ì ˆ</div>

                    </table>
                </div>


            </div>

        </div>

        <!-- ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ -->
        <th:block layout:fragment="script">
            <!-- DataTables ì´ˆê¸°í™” ë° ì „ì²´ ì„ íƒ ê¸°ëŠ¥ -->
            <script type="text/javascript">
                $(document).ready(function () {
                    // DataTables ì´ˆê¸°í™”
                    $("#basic-datatables").DataTable();

                    // ì „ì²´ ì„ íƒ/í•´ì œ ê¸°ëŠ¥
                    $("#select-all").on("click", function () {
                        $("input[name='select-row']").prop("checked", this.checked);
                    });
                });

                // í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                function confirmApproval() {
                    const selectedRows = document.querySelectorAll("input[name='select-row']:checked");

                    if (selectedRows.length === 0) {
                        // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
                        Swal.fire({
                            title: 'ì¶œê³ í•  ê±´ì„ ì²´í¬í•´ì£¼ì„¸ìš”',
                            icon: 'warning',
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'í™•ì¸'
                        });
                        return; // í•¨ìˆ˜ ì¢…ë£Œ
                    }

                    // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒëœ ê²½ìš° ìŠ¹ì¸ ì•Œë¦¼
                    Swal.fire({
                        title: 'ì¶œê³  ìŠ¹ì¸',
                        text: "ì¶œê³ ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'ìŠ¹ì¸',
                        cancelButtonText: 'ì·¨ì†Œ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire(
                                'ìŠ¹ì¸ ì™„ë£Œ!',
                                'ì¶œê³ ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
                                'success'
                            );
                        } else {
                            Swal.fire(
                                'ì·¨ì†Œë¨',
                                'ì¶œê³  ìŠ¹ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.',
                                'error'
                            );
                        }
                    });
                }
            </script>

            <script>
                function confirmRejection() {
                    const selectedRows = document.querySelectorAll("input[name='select-row']:checked");
                    const selectedIds = Array.from(selectedRows).map(row => row.value); // ì„ íƒëœ ì¶œê³  ID ë°°ì—´

                    if (selectedIds.length === 0) {
                        Swal.fire({
                            title: 'ê±°ì ˆí•  ì¶œê³ ê±´ì„ ì²´í¬í•´ì£¼ì„¸ìš”',
                            icon: 'warning',
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'í™•ì¸'
                        });
                        return;
                    }

                    Swal.fire({
                        title: 'ì¶œê³  ê±°ì ˆ',
                        text: "ì„ íƒëœ ì¶œê³ ë¥¼ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'ê±°ì ˆ',
                        cancelButtonText: 'ì·¨ì†Œ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡
                            fetch('/reject-outgoing', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ outgoingIds: selectedIds }) // ì„ íƒëœ ID ì „ì†¡
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        Swal.fire(
                                            'ê±°ì ˆ ì™„ë£Œ!',
                                            'ì„ íƒëœ ì¶œê³ ê°€ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.',
                                            'success'
                                        ).then(() => location.reload()); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                                    } else {
                                        Swal.fire(
                                            'ì‹¤íŒ¨!',
                                            data.message || 'ì¶œê³  ê±°ì ˆì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
                                            'error'
                                        );
                                    }
                                })
                                .catch(error => {
                                    Swal.fire(
                                        'ì˜¤ë¥˜!',
                                        'ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                                        'error'
                                    );
                                });
                        }
                    });
                }
            </script>

            <style>
                #floating-button-approve {
                    position: fixed;
                    bottom: 80px; /* ì¶œê³  ê±°ì ˆ ë²„íŠ¼ ìœ„ë¡œ ìœ„ì¹˜ */
                    right: 20px;
                    background-color: #28a745;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 50px;
                    font-size: 16px;
                    font-weight: bold;
                    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    cursor: pointer;
                    z-index: 1000;
                }

                #floating-button-reject {
                    position: fixed;
                    bottom: 20px; /* í™”ë©´ í•˜ë‹¨ì— ìœ„ì¹˜ */
                    right: 20px;
                    background-color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
                    color: white;
                    padding: 15px 20px;
                    border-radius: 50px;
                    font-size: 16px;
                    font-weight: bold;
                    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                    cursor: pointer;
                    z-index: 1000;
                }

                #floating-button-reject:hover {
                    background-color: #c82333; /* hover ì‹œ ë” ì–´ë‘ìš´ ë¹¨ê°„ìƒ‰ */
                }
            </style>

            <script>
                document.addEventListener("scroll", function () {
                    const floatingButton = document.getElementById("floating-button");
                    const footer = document.querySelector("footer"); // footer ìš”ì†Œ ì„ íƒ
                    const footerRect = footer.getBoundingClientRect(); // footerì˜ ìœ„ì¹˜ ì •ë³´
                    const windowHeight = window.innerHeight; // ë¸Œë¼ìš°ì € ì°½ ë†’ì´

                    // footerê°€ í™”ë©´ì— ë‚˜íƒ€ë‚˜ê¸° ì‹œì‘í•˜ë©´ í”Œë¡œíŒ… ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì •
                    if (footerRect.top < windowHeight) {
                        floatingButton.style.bottom = `${windowHeight - footerRect.top + 20}px`; // footer ìœ„ë¡œ ë²„íŠ¼ ìœ„ì¹˜
                    } else {
                        floatingButton.style.bottom = "20px"; // ê¸°ë³¸ ìœ„ì¹˜
                    }
                });
            </script>

            <script>
                function showApprovalAlert() {
                    // ì„ íƒëœ ì²´í¬ë°•ìŠ¤ í™•ì¸
                    const selectedRows = document.querySelectorAll("input[name='select-row']:checked");

                    if (selectedRows.length === 0) {
                        // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
                        Swal.fire({
                            title: 'ì¶œê³ í•  ê±´ì„ ì²´í¬í•´ì£¼ì„¸ìš”',
                            icon: 'warning',
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'í™•ì¸'
                        });
                        return; // í•¨ìˆ˜ ì¢…ë£Œ
                    }

                    // ì²´í¬ë°•ìŠ¤ê°€ ì„ íƒëœ ê²½ìš° ìŠ¹ì¸ ì•Œë¦¼
                    Swal.fire({
                        title: 'ì¶œê³  ìŠ¹ì¸',
                        text: "ì¶œê³ ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'ìŠ¹ì¸',
                        cancelButtonText: 'ì·¨ì†Œ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            Swal.fire(
                                'ìŠ¹ì¸ ì™„ë£Œ!',
                                'ì¶œê³ ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.',
                                'success'
                            );
                        } else {
                            Swal.fire(
                                'ì·¨ì†Œë¨',
                                'ì¶œê³  ìŠ¹ì¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.',
                                'error'
                            );
                        }
                    });
                }
            </script>

        </th:block>
    </div>
</div>
</body>
</html>
